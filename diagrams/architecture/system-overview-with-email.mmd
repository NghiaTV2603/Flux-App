graph TB
    %% Client Layer
    subgraph "Client Applications"
        WebApp[ğŸŒ Web App<br/>React/Vue]
        MobileApp[ğŸ“± Mobile App<br/>React Native]
        DesktopApp[ğŸ–¥ï¸ Desktop App<br/>Electron]
    end

    %% Gateway Layer
    subgraph "API Gateway"
        Gateway[ğŸšª Gateway API<br/>Node.js/NestJS<br/>Auth, Rate Limiting]
    end

    %% Service Layer
    subgraph "Microservices Architecture"
        subgraph "Core Services (Node.js/NestJS)"
            AuthService[ğŸ” Auth Service<br/>JWT, OAuth, Password]
            UserService[ğŸ‘¥ User & Social Service<br/>Profiles, Friends, Social]
            ServerService[ğŸ¢ Server & Channel Service<br/>Servers, Channels, Roles]
            MessageService[ğŸ’¬ Message Service<br/>Chat, DM, Reactions]
            MediaService[ğŸ“ Media & File Service<br/>Upload, Storage, CDN]
            RealtimeService[âš¡ Realtime Service<br/>WebSocket, Voice, Live]
        end
        
        subgraph "Email Service (Spring Boot)"
            EmailService[ğŸ“§ Email Service<br/>Spring Boot + Java<br/>Templates, Queue, Tracking]
        end
    end

    %% Message Broker
    subgraph "Message Queue"
        RabbitMQ[ğŸ° RabbitMQ<br/>Event-Driven Communication]
    end

    %% Database Layer
    subgraph "Data Storage"
        subgraph "PostgreSQL Databases"
            AuthDB[(ğŸ—„ï¸ Auth DB<br/>Users, OAuth)]
            UserDB[(ğŸ—„ï¸ User DB<br/>Profiles, Friends)]
            ServerDB[(ğŸ—„ï¸ Server DB<br/>Servers, Channels)]
            MediaDB[(ğŸ—„ï¸ Media DB<br/>File Metadata)]
            RealtimeDB[(ğŸ—„ï¸ Realtime DB<br/>Sessions, Voice)]
            EmailDB[(ğŸ—„ï¸ Email DB<br/>Templates, Queue, Logs)]
        end
        
        MongoDB[(ğŸƒ MongoDB<br/>Messages, Chat History)]
        Redis[(ğŸ”´ Redis<br/>Cache, Sessions, Rate Limiting)]
        S3[(â˜ï¸ S3/MinIO<br/>File Storage)]
    end

    %% External Services
    subgraph "External Services"
        SMTP[ğŸ“¤ SMTP Server<br/>Gmail/SendGrid]
        OAuth[ğŸ”‘ OAuth Providers<br/>Google, GitHub, Discord]
    end

    %% Connections
    WebApp --> Gateway
    MobileApp --> Gateway
    DesktopApp --> Gateway

    Gateway --> AuthService
    Gateway --> UserService
    Gateway --> ServerService
    Gateway --> MessageService
    Gateway --> MediaService
    Gateway --> RealtimeService

    %% Service to Database connections
    AuthService --> AuthDB
    UserService --> UserDB
    UserService --> Redis
    ServerService --> ServerDB
    ServerService --> Redis
    MessageService --> MongoDB
    MediaService --> MediaDB
    MediaService --> S3
    RealtimeService --> RealtimeDB
    RealtimeService --> Redis
    EmailService --> EmailDB
    EmailService --> Redis

    %% Event-driven connections
    AuthService --> RabbitMQ
    UserService --> RabbitMQ
    ServerService --> RabbitMQ
    MessageService --> RabbitMQ
    RabbitMQ --> EmailService

    %% External service connections
    AuthService --> OAuth
    EmailService --> SMTP

    %% Styling
    classDef serviceNode fill:#e1f5fe,stroke:#01579b,stroke-width:2px
    classDef dbNode fill:#f3e5f5,stroke:#4a148c,stroke-width:2px
    classDef clientNode fill:#e8f5e8,stroke:#1b5e20,stroke-width:2px
    classDef emailNode fill:#fff3e0,stroke:#e65100,stroke-width:3px
    classDef externalNode fill:#fce4ec,stroke:#880e4f,stroke-width:2px

    class AuthService,UserService,ServerService,MessageService,MediaService,RealtimeService,Gateway serviceNode
    class AuthDB,UserDB,ServerDB,MediaDB,RealtimeDB,EmailDB,MongoDB,Redis,S3 dbNode
    class WebApp,MobileApp,DesktopApp clientNode
    class EmailService emailNode
    class SMTP,OAuth externalNode
